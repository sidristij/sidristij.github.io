<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>.NET Platform Architecture</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <style>
        body {
    padding: 60px 60px 60px 100px;
}

p, li {
    margin: 0 0 14px;
    font-family: PF Regal,PF Regal Text Pro,Georgia,serif;
    font-size: 20px;
    line-height: 32px;
}

ol, ul {
    padding-left: 35px;
    margin-top: 1.1rem;
    margin-bottom: 1.1rem;
}

ol li {
    padding-left: 10px;	
}

ul li {
    padding-left: 5px;	
}

code, .lang-csharp span, .lang-csharp pre {
    font-family: JB Mono, monospace !important;
}

.lang-csharp {
    padding: 4px 0px 14px 0px;
}


.lang-csharp > div {
    border-left-color: #eee;
    border-left-style: dotted;
    border-left-width: 3px;
    padding-left: 25px;
}

code {
    font-size: 14px;
    border: gainsboro;
    border-width: 1px;
    border-style: solid;
    padding: 2px;
    color: darkslateblue;
}

.lang-csharp span, .lang-csharp pre {
    font-size: 13px;
    line-height: 20px;
}

p a {
    text-decoration: none;
    color: inherit;
    box-shadow: inset 0 -1px #b88b59;
}

p img {
    width: 95%;
}

img < p {
    text-align: center;
}

blockquote p {
    margin: 16px 0;
    padding: 12px 12px 13px;
    border: 1px solid rgba(0,0,0,.08);
    border-radius: 8px;
    background: #fff8c4;
    font-family: Proxima Nova,Arial,Helvetica Neue,sans-serif;
    font-size: 16px;
    font-weight: 400;
    line-height: 24px;
}

blockquote p code {
    font-family: consolas, monospace;
    font-size: 17px;
    background-color: aliceblue;
    padding: 4px 6px;
}

h1, h2, h3, h4, h5, h6 {
    margin: 0;
    padding: 0;
    font-weight: 400;
}

h1 {
    font-size: 38px;
    font-family: PF Regal,PF Regal Text Pro,Georgia,serif;
    font-weight: 400;
    margin: 40px 0 10px 0;
}

h1 b {
    font-family: Proxima Nova,Arial,Helvetica Neue,sans-serif;
    font-weight: 700;
    font-size: 37px;
    line-height: 42px;
}

h2 {
    margin-top: 35px;
    margin-bottom: 10px;
    font-family: Proxima Nova,Arial,Helvetica Neue,sans-serif;
    font-size: 20px;
    font-weight: 700;
    line-height: 24px;
    border-bottom-color: aliceblue;
    border-bottom-style: solid;
    padding-bottom: 5px;
}

h3 {
    margin: 30px 0 10px 0;
    border-bottom-color: azure;
    border-bottom-style: solid;
    border-bottom-width: 2px;
    font-size: 17pt;
    font-weight: 300;
}


// Fonts
@font-face {
    font-family: 'JB Mono';
    src: local('JetBrains Mono'),
    url('../../res/fonts/woff2/JetBrainsMono-Italic.woff2') format('woff2'),
    url('../../res/fonts/woff/JetBrainsMono-Italic.woff') format('woff'),
    url('../../res/fonts/ttf/JetBrainsMono-Italic.ttf') format('truetype');
    font-weight: 400;
    font-style: italic;
}
@font-face {
    font-family: 'JB Mono';
    src: local('JetBrains Mono'),
    url('../../res/fonts/woff2/JetBrainsMono-Regular.woff2') format('woff2'),
    url('../../res/fonts/woff/JetBrainsMono-Regular.woff') format('woff'),
    url('../../res/fonts/ttf/JetBrainsMono-Regular.ttf') format('truetype');
    font-weight: 400;
    font-style: normal;
}
@font-face {
    font-family: 'JB Mono';
    src: local('JetBrains Mono'),
    url('../../res/fonts/woff2/JetBrainsMono-Medium-Italic.woff2') format('woff2'),
    url('../../res/fonts/woff/JetBrainsMono-Medium-Italic.woff') format('woff'),
    url('../../res/fonts/ttf/JetBrainsMono-Medium-Italic.ttf') format('truetype');
    font-weight: 600;
    font-style: italic;
}
@font-face {
    font-family: 'JB Mono';
    src: local('JetBrains Mono'),
    url('../../res/fonts/woff2/JetBrainsMono-Medium.woff2') format('woff2'),
    url('../../res/fonts/woff/JetBrainsMono-Medium.woff') format('woff'),
    url('../../res/fonts/ttf/JetBrainsMono-Medium.ttf') format('truetype');
    font-weight: 600;
    font-style: normal;
}
@font-face {
    font-family: 'PF Regal Text Pro';
    src: local('PF Regal Text Pro RegularA'), local('PF-Regal-Text-Pro-RegularA'),
    url('../../res/fonts/woff2/PFRegalTextPro-RegularA.woff2') format('woff2'),
    url('../../res/fonts/woff/PFRegalTextPro-RegularA.woff') format('woff'),
    url('../../res/fonts/ttf/PFRegalTextPro-RegularA.ttf') format('truetype');
    font-weight: 400;
    font-style: normal;
}
@font-face {
    font-family: 'PF Regal Text Pro';
    src: local('PF Regal Text Pro RegularB'), local('PF-Regal-Text-Pro-RegularB'),
    url('../../res/fonts/woff2/PFRegalTextPro-RegularB.woff2') format('woff2'),
    url('../../res/fonts/woff/PFRegalTextPro-RegularB.woff') format('woff'),
    url('../../res/fonts/ttf/PFRegalTextPro-RegularB.ttf') format('truetype');
    font-weight: 600;
    font-style: normal;
}
@font-face {
    font-family: 'PF Regal Text Pro';
    src: local('PF Regal Text Pro RegularB Italic'), local('PF-Regal-Text-Pro-RegularB-Italic'),
    url('../../res/fonts/woff2/PFRegalTextPro-RegularBItalic.woff2') format('woff2'),
    url('../../res/fonts/woff/PFRegalTextPro-RegularBItalic.woff') format('woff'),
    url('../../res/fonts/ttf/PFRegalTextPro-RegularBItalic.ttf') format('truetype');
    font-weight: 600;
    font-style: italic;
}
  
    </style>

<div style="margin:auto; width:100%;">
<div style="width:1000px;">
    <h1 id="section">Основы управления памятью [В процессе]</h1>
<blockquote>
<p>Если статья находится в процессе, это значит, что прямо в эти минуты я ее правлю и возможно, часть информации не является достоверной</p>
</blockquote>
<h1 id="section-1">Обзор</h1>
<p>Когда вы думаете о разработке любого .NET приложения до недавних пор можно было себе позволить считать, что приложение, которое вы делаете, будет всегда работать на одной и той же платформе: это операционная система Windows, запущенная поверх технологического стека Intel. Сейчас же с каждым прожитым днем мы входим в новую эпоху: платформа .NET стала поистине кроссплатформенной, пустив новые корни в сторону всех доступных настольных операционных систем. Это - прекрасное время и наш долг сейчас не потерять нить и остаться востребованными специалистами. Ведь когда toolset становится кроссплатформенным, это означает что мы обязаны начать смотреть внутрь. Изучать, как работает двигатель нашей платформы. Чтобы понимать, почему тот ведет себя, так или иначе, на различных системах.</p>
<p>Подсистему управления памятью мы будем изучать по слоям. Начнем от слоя, близкого к пониманию ее работы &quot;на пальцах&quot; и закончим - слоем архитектуры на самом низком уровне - процессорном. Ведь чтобы до конца понимать всю проблематику работы с памятью - надо знать все, начиная от процессорных кэшей заканчивая оптимизациями работы c кучами .NET.</p>
<h2 id="section-2">Основы основ</h2>
<p>Если взять любое приложение и попробовать грубо разделить его на две части, то получится, что любое приложение состоит фактически из двух самых важных вещей: кода, который исполняется процессором, и данных, которыми этот код оперирует в своей работе. Причем если с кодом все более-менее ясно, то данные можно поделить на несколько больших секций:</p>
<ul>
<li><strong>Thread stack</strong> - область памяти, которая есть у любого потока и через которую работают все вызовы всех методов, плюс там же организовано хранилище для локальных переменных методов;</li>
<li><strong>Code Heap</strong> - это область памяти, куда JITter складывает результаты компиляции MSIL;</li>
<li><strong>Small Objects Heap</strong> - это куча маленьких объектов. Как бы это не звучало, именно так это и называется. По своей сути это - хранилище объектов, размер которых не превышает 85К байт;</li>
<li><strong>Large Objects Heap</strong> - это куча больших объектов. Сюда попадают объекты, размеры которых превышают 85K байт;</li>
<li><strong>TypeRefs Heap</strong> - куча Type References - описателей типов .NET - со стороны подсистемы CLR (со стороны .NET типов выступает подсистема Reflection)</li>
<li><strong>MethodRefs Heap</strong> - куча Methods References - описателей методов .NET - со стороны подсистемы CLR (со стороны .NET типов выступает подсистема Reflection)</li>
<li>И многие другие</li>
</ul>

</div>
</div>
</body>
</html>